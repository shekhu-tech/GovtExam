<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>STISkilli History PYQ â€“ Ancient, Medieval, Modern, World & Art Previous Year Questions</title>
<script src="/app-redirect.js"></script>
<meta name="description" content="Practice STISkilli History PYQ with Ancient, Medieval, Modern, World History & Art Previous Year Questions. Premium AI-powered preparation for competitive exams, government jobs & GK in India.">
<meta name="keywords" content="History PYQ, Ancient History PYQ, Medieval History PYQ, Modern History PYQ, World History PYQ, Art & Culture PYQ, Competitive Exam History, STISkilli">
<meta name="author" content="StiSkilli">
<meta name="publisher" content="StiSkilli">
<meta name="brand" content="StiSkilli App">
<meta name="topic" content="History Previous Year Questions, Competitive Exams, Education">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<meta name="googlebot" content="index, follow">
<!-- VIEWPORT -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<!-- CANONICAL (APP LINK USED) -->
<link rel="canonical" href="https://play.google.com/store/apps/details?id=com.ai.skillaura">
<!-- =========================
     OPEN GRAPH (FB / INSTA / WHATSAPP)
========================== -->
<meta property="og:type" content="website">
<meta property="og:title" content="STISkilli History PYQ â€“ Previous Year Questions">
<meta property="og:description" content="Solve History Previous Year Questions (PYQ) with STISkilli â€“ Ancient, Medieval, Modern, World & Art. AI-powered exam prep app.">
<meta property="og:url" content="https://play.google.com/store/apps/details?id=com.ai.skillaura&pcampaignid=web_share">
<meta property="og:image" content="https://play-lh.googleusercontent.com/your-app-icon.png">
<meta property="og:site_name" content="StiSkilli">
<!-- =========================
     TWITTER / X SEO
========================== -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="STISkilli History PYQ â€“ Exam Preparation App">
<meta name="twitter:description" content="Best AI-powered History PYQ App for Competitive Exams & Government Jobs in India.">
<meta name="twitter:image" content="https://play-lh.googleusercontent.com/your-app-icon.png">
<!-- =========================
     APP DEEP LINK SEO
========================== -->
<meta name="application-name" content="StiSkilli">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#F4C430">
<!-- ANDROID APP INDEXING -->
<link rel="alternate" href="android-app://com.ai.skillaura/https/play.google.com/store/apps/details?id=com.ai.skillaura">

<!-- =========================
     AI SEARCH ENTITY SIGNAL
========================== -->
<meta name="ai-content-declaration" content="This page provides History Previous Year Questions (PYQ) inside the STISkilli AI Career & Exam Preparation App.">

<!-- =========================
     STRUCTURED DATA (JSON-LD)
========================== -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": ["MobileApplication","LearningResource","EducationalOrganization"],
  "name": "STISkilli History PYQ",
  "description": "History Previous Year Questions (PYQ) covering Ancient, Medieval, Modern, World History and Art for Competitive Exams.",
  "educationalLevel": "Competitive Exam Preparation",
  "publisher": {
    "@type": "Organization",
    "name": "StiSkilli"
  },
  "operatingSystem": "Android",
  "applicationCategory": "EducationApplication",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "INR"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "ratingCount": "100000"
  },
  "url": "https://play.google.com/store/apps/details?id=com.ai.skillaura"
}
</script>

<!-- =========================
     PERFORMANCE & AI SEARCH
========================== -->
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">

<!-- =========================
     FAVICON
========================== -->
<link rel="icon" href="https://play-lh.googleusercontent.com/your-app-icon.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800;900&family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap" rel="stylesheet">ht@500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --primary: #F4C430;       
            --primary-glow: #FFD700; 
            --dark-glass: rgba(10, 10, 10, 0.85);
            --border-color: rgba(255, 215, 0, 0.3);
            --header-height: 70px; 
            --footer-height: 75px; 
            --correct: #00e676;
            --wrong: #ff1744;
        }

        /* --- GLOBAL RESET --- */
        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100dvh;
            overflow: hidden; 
            position: fixed; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #000;
            color: #fff;
            overscroll-behavior: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- UNIVERSE BACKGROUND --- */
        #universe-bg {
            position: fixed; top: -10%; left: -10%; width: 120%; height: 120%;
            z-index: -10;
            background: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2072&auto=format&fit=crop');
            background-size: cover;
            filter: contrast(120%) brightness(40%);
            animation: galaxyMove 60s linear infinite alternate;
        }
        @keyframes galaxyMove { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* --- GOLDEN BORDER ANIMATION --- */
        .golden-border-anim {
            border: 2px solid var(--primary);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            animation: borderPulse 3s infinite alternate;
        }
        @keyframes borderPulse {
            0% { box-shadow: 0 0 10px rgba(244, 196, 48, 0.2); border-color: #bfa128; }
            100% { box-shadow: 0 0 20px rgba(244, 196, 48, 0.6), inset 0 0 10px rgba(244, 196, 48, 0.2); border-color: #ffd700; }
        }

        /* --- HEADER --- */
        .glass-header {
            position: fixed; top: calc(15px + env(safe-area-inset-top)); left: 50%; transform: translateX(-50%);
            width: 94%; max-width: 800px; height: var(--header-height);
            background: rgba(5, 5, 5, 0.85); backdrop-filter: blur(25px);
            border-radius: 24px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; z-index: 3000;
        }
        .header-logo { width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--primary); object-fit: cover; box-shadow: 0 0 10px var(--primary-glow); }
        .header-title-img { height: 32px; width: auto; object-fit: contain; filter: drop-shadow(0 0 5px var(--primary)); }

        /* --- DOCK (Footer) --- */
        .dock-wrapper { position: fixed; bottom: calc(20px + env(safe-area-inset-bottom)); left: 0; width: 100%; display: flex; justify-content: center; z-index: 3000; padding: 0 5px; }
        .glass-dock { 
            width: 100%; max-width: 700px; 
            height: var(--footer-height); 
            background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(30px);
            border-radius: 24px; 
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10px;
        }
        .dock-item { 
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; 
            color: rgba(255, 255, 255, 0.3); cursor: pointer; position: relative;
            transition: all 0.3s ease; border-radius: 16px; flex: 1;
        }
        .dock-item i { font-size: 1.4rem; transition: 0.3s; }
        .dock-item.active { 
            color: var(--primary-glow); 
            background: radial-gradient(circle, rgba(244, 196, 48, 0.2) 0%, transparent 70%);
            text-shadow: 0 0 20px var(--primary);
        }
        .dock-item.active i { transform: scale(1.1); filter: drop-shadow(0 0 5px var(--primary)); }

        /* --- MAIN MODAL --- */
        .modal-overlay { 
            position: fixed; 
            top: calc(var(--header-height) + 30px + env(safe-area-inset-top)); 
            bottom: calc(var(--footer-height) + 35px + env(safe-area-inset-bottom)); 
            left: 0; right: 0; 
            z-index: 2500; 
            display: flex; justify-content: center; align-items: center;
            padding: 0 10px; pointer-events: none; 
        }

        .modal-box { 
            pointer-events: auto; 
            background-color: #111; 
            background-size: cover; background-position: center; background-repeat: no-repeat;
            border-radius: 30px; 
            width: 100%; max-width: 1400px; height: 100%; padding: 15px; 
            display: flex; flex-direction: column; overflow: hidden;
            text-shadow: 0 2px 5px rgba(0,0,0,0.9);
            position: relative; 
        }

        /* HEADER INSIDE MODAL */
        .modal-header-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 15px; flex-shrink: 0; }
        .modal-header { text-align: center; background: rgba(0,0,0,0.6); padding: 8px 25px; border-radius: 50px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; width: fit-content; min-width: 180px; }
        .modal-header h2 { font-family: 'Rajdhani'; font-weight: 900; font-size: 1.5rem; color: #fff; text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); margin: 0; letter-spacing: 1px; text-transform: uppercase; }
        
        .sub-nav { background: rgba(0,0,0,0.7); border-radius: 20px; padding: 8px; display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; white-space: nowrap; width: 100%; }
        .sub-item { padding: 8px 20px; border-radius: 12px; font-size: 0.8rem; font-family: 'Rajdhani'; font-weight: 700; color: #ccc; border: 1px solid transparent; transition: 0.3s; cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 5px; }
        .sub-item.active { background: var(--primary); color: #000; border-color: var(--primary-glow); box-shadow: 0 0 20px rgba(244, 196, 48, 0.4); font-weight: 800; }
        .sub-item.locked { opacity: 0.5; cursor: not-allowed; background: #222; border: 1px solid #444; }

        /* --- QUIZ INTERFACE --- */
        #quiz-interface { flex-grow: 1; display: none; flex-direction: column; overflow-y: auto; padding-bottom: 20px; }
        
        .quiz-stats-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.05); border-radius: 12px;
            padding: 8px 15px; margin-bottom: 15px; border: 1px solid rgba(255, 215, 0, 0.2);
        }
        .stat-item { font-family: 'Rajdhani'; font-weight: 700; font-size: 0.9rem; color: #ddd; }
        .stat-val { color: var(--primary); font-size: 1.1rem; margin-left: 5px; }

        .question-box {
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            border-radius: 16px; padding: 20px; margin-bottom: 15px;
            border-left: 3px solid var(--primary);
        }
        .q-text { font-size: 1.1rem; line-height: 1.4; font-weight: 600; color: #fff; }

        .options-list { display: flex; flex-direction: column; gap: 10px; }
        .option-btn {
            background: rgba(30, 30, 30, 0.9); border: 1px solid #444;
            padding: 14px 18px; border-radius: 12px; color: #eee;
            font-weight: 500; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.95rem;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-btn.correct { background: rgba(0, 230, 118, 0.15); border-color: var(--correct); color: var(--correct); }
        .option-btn.wrong { background: rgba(255, 23, 68, 0.15); border-color: var(--wrong); color: var(--wrong); }

        /* --- ULTRA PRO PROFILE STYLES --- */
        #profile-section { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; overflow-y: auto; padding: 10px 5px; }

        /* Glass Cards */
        .glass-panel {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 30px 25px;
            width: 100%; max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; align-items: center;
        }

        /* Input Styling */
        .gold-input-group { width: 100%; margin-bottom: 20px; text-align: left; }
        .gold-label { font-size: 0.8rem; color: var(--primary); font-weight: 700; margin-left: 10px; margin-bottom: 5px; display: block; letter-spacing: 1px; }
        .gold-input {
            width: 100%; background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 15px; border-radius: 12px;
            color: #fff; font-size: 1rem;
            transition: 0.3s;
            outline: none;
        }
        .gold-input:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(244, 196, 48, 0.2); background: rgba(0,0,0,0.6); }

        /* Buttons */
        .btn-pro {
            width: 100%;
            background: linear-gradient(135deg, #FFD700 0%, #B8860B 100%);
            color: #000; font-family: 'Rajdhani'; font-weight: 800; font-size: 1.2rem;
            padding: 16px; border-radius: 16px; border: none;
            cursor: pointer; position: relative; overflow: hidden;
            box-shadow: 0 5px 20px rgba(244, 196, 48, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-pro:active { transform: scale(0.98); }
        .btn-pro::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(rgba(255,255,255,0.4), transparent);
            transform: rotate(45deg); transition: 0.5s; opacity: 0;
        }
        .btn-pro:hover::after { opacity: 1; left: 100%; }

        /* Plan Cards */
        .plans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; margin-bottom: 20px; }
        .plan-card-pro {
            background: rgba(30, 30, 30, 0.6); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 15px; cursor: pointer;
            transition: 0.3s; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .plan-card-pro:hover { background: rgba(40,40,40,0.8); }
        .plan-card-pro.selected {
            background: rgba(244, 196, 48, 0.15);
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(244, 196, 48, 0.15);
        }
        .pc-dur { font-size: 0.9rem; color: #ccc; font-weight: 600; }
        .pc-price { font-size: 1.4rem; color: var(--primary); font-family: 'Rajdhani'; font-weight: 800; margin: 5px 0; }
        .pc-check { position: absolute; top: 5px; right: 5px; color: var(--primary); opacity: 0; transition: 0.2s; }
        .plan-card-pro.selected .pc-check { opacity: 1; }

        /* Dashboard (Step 4) */
        .dashboard-container { width: 100%; max-width: 600px; display: flex; flex-direction: column; gap: 20px; }
        
        /* Membership Card */
        .membership-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #000 100%);
            border: 1px solid #333;
            border-radius: 24px; padding: 25px;
            position: relative; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 200px;
        }
        .membership-card::before {
            content: ''; position: absolute; top: -50px; right: -50px; width: 150px; height: 150px;
            background: radial-gradient(circle, rgba(244,196,48,0.3) 0%, transparent 70%);
            filter: blur(20px);
        }
        .mc-header { display: flex; justify-content: space-between; align-items: flex-start; z-index: 2; }
        .mc-chip { width: 45px; height: 30px; background: linear-gradient(45deg, #FFD700, #FDB931); border-radius: 6px; position: relative; overflow: hidden; box-shadow: inset 0 0 5px rgba(0,0,0,0.3); }
        .mc-chip::after { content: ''; position: absolute; top:0; left:50%; width:1px; height:100%; background:rgba(0,0,0,0.2); }
        .mc-plan-badge { 
            background: rgba(244, 196, 48, 0.2); border: 1px solid var(--primary); 
            color: var(--primary); padding: 5px 12px; border-radius: 50px; 
            font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; 
        }
        .mc-user { z-index: 2; margin-top: auto; }
        .mc-name { font-family: 'Rajdhani'; font-size: 1.8rem; font-weight: 800; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5); letter-spacing: 1px; }
        .mc-email { color: #888; font-size: 0.9rem; margin-top: -2px; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* UPDATED STAT BOX (DARK GRAY) */
        .stat-box {
            background: rgba(30, 30, 30, 0.9); /* Dark Gray */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px; padding: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .sb-icon { font-size: 1.2rem; color: #ccc; margin-bottom: 5px; } 
        .sb-val { font-family: 'Rajdhani'; font-size: 1.5rem; font-weight: 800; color: #fff; }
        .sb-label { font-size: 0.7rem; color: #ddd; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }

        /* Professional Progress List */
        .pro-progress-header { font-family: 'Rajdhani'; font-size: 1.3rem; color: #fff; font-weight: 800; margin-top: 10px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .pro-progress-header::after { content:''; flex:1; height:1px; background: rgba(255,255,255,0.1); }
        
        .pp-item {
            background: linear-gradient(90deg, rgba(20,20,20,0.9) 0%, rgba(30,30,30,0.9) 100%);
            border-left: 4px solid var(--primary);
            border-radius: 8px; padding: 15px; margin-bottom: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .pp-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .pp-title { font-size: 0.9rem; font-weight: 700; color: #ddd; }
        .pp-score { background: rgba(244, 196, 48, 0.2); color: var(--primary); padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 800; font-family: 'Rajdhani'; }
        
        .pp-bar-bg { width: 100%; height: 6px; background: #111; border-radius: 10px; overflow: hidden; position: relative; }
        .pp-bar-fill { height: 100%; background: linear-gradient(90deg, #F4C430, #FFD700); border-radius: 10px; box-shadow: 0 0 10px var(--primary); transition: width 1s ease; }
        
        .pp-meta { display: flex; justify-content: flex-end; gap: 15px; font-size: 0.75rem; color: #666; margin-top: 8px; }
        .pp-meta span i { margin-right: 4px; }


        /* --- POPUPS --- */
        .overlay-popup {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(5, 5, 5, 0.98); z-index: 50;
            display: none; 
            flex-direction: column; align-items: center; justify-content: center;
            border-radius: 30px; text-align: center;
            padding: 20px;
        }
        .res-emoji { font-size: 4rem; margin-bottom: 15px; }
        .res-title { font-family: 'Rajdhani'; font-size: 2.2rem; font-weight: 900; color: #fff; margin-bottom: 15px; line-height: 1.1; }
        .res-btn { padding: 14px 35px; font-family: 'Rajdhani'; font-weight: 800; font-size: 1.1rem; border-radius: 50px; border: none; cursor: pointer; background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary-glow); margin-top: 25px; }
        
        .welcome-text { color: #ccc; margin-bottom: 20px; font-size: 1rem; max-width: 80%; line-height: 1.5; }
        .user-highlight { color: var(--primary); font-weight: 800; font-size: 1.2rem; }

        /* --- NEWS/DISCOVERY SECTION STYLES --- */
        #news-section { width: 100%; height: 100%; display: none; flex-direction: column; overflow-y: auto; padding-bottom: 20px; }
        .news-container { display: flex; flex-direction: column; gap: 15px; padding: 0 5px; }
        
        .news-card {
            background: rgba(15, 15, 15, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.3s;
        }
        .news-card:active { transform: scale(0.98); }
        
        .news-img { width: 100%; height: 140px; object-fit: cover; border-bottom: 1px solid #333; }
        .news-body { padding: 15px; }
        .news-tag { font-size: 0.7rem; color: #000; background: var(--primary); padding: 2px 8px; border-radius: 4px; font-weight: 800; display: inline-block; margin-bottom: 8px; font-family: 'Rajdhani'; }
        .news-title { font-size: 1.1rem; font-weight: 700; color: #fff; margin-bottom: 6px; line-height: 1.3; font-family: 'Plus Jakarta Sans'; }
        .news-desc { font-size: 0.85rem; color: #aaa; margin-bottom: 12px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .news-btn { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 8px 15px; border-radius: 8px; font-size: 0.8rem; font-weight: 700; width: 100%; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 5px; transition: 0.3s; }
        .news-btn:hover { background: rgba(244, 196, 48, 0.1); }

    </style>
</head>
<body>

    <div id="universe-bg"></div>

    <header class="glass-header golden-border-anim">
        <img class="header-logo" src="sti.png" alt="Logo" onerror="this.src='https://via.placeholder.com/44/FFD700/000?text=S'">
        <img class="header-title-img" src="skillora.png" alt="SKILLI" onerror="this.style.display='none'">
        <img class="header-logo" src="ytglogo.png" alt="Logo" onerror="this.src='https://via.placeholder.com/44/FFD700/000?text=Y'">
    </header>

    <div class="dock-wrapper">
        <nav class="glass-dock golden-border-anim">
            <div id="nav-profile" class="dock-item" onclick="openCategory('profile', this)"><i class="fas fa-user-circle"></i></div>
            <div id="nav-ancient" class="dock-item" onclick="openCategory('ancient', this)"><i class="fas fa-gopuram"></i></div>
            <div id="nav-medieval" class="dock-item" onclick="openCategory('medieval', this)"><i class="fas fa-monument"></i></div>
            <div id="nav-modern" class="dock-item" onclick="openCategory('modern', this)"><i class="fas fa-flag"></i></div>
            <div id="nav-world" class="dock-item" onclick="openCategory('world', this)"><i class="fas fa-globe"></i></div>
            <div id="nav-art" class="dock-item" onclick="openCategory('art', this)"><i class="fas fa-palette"></i></div>
            <div id="nav-news" class="dock-item" onclick="openCategory('news', this)"><i class="fas fa-newspaper"></i></div>
        </nav>
    </div>

    <div id="main-modal" class="modal-overlay flex-modal">
        <div class="modal-box golden-border-anim" id="dynamic-modal-box">
            
            <div class="modal-header-container" id="common-header">
                <div class="modal-header">
                    <h2 id="cat-title">PROFILE</h2>
                </div>
                <div class="sub-nav golden-border-anim" id="sub-nav-container"></div>
            </div>

            <div id="news-section">
                <div class="news-container" id="news-feed"></div>
            </div>

            <div id="quiz-interface" style="display: none;">
                <div class="quiz-stats-bar">
                    <div class="stat-item"><span id="unit-name-display">UNIT 1</span></div>
                    <div class="stat-item" style="color:#ff1744; font-weight:800;"><i class="fas fa-clock"></i> <span id="q-timer">30</span>s</div>
                    <div class="stat-item">Q: <span id="q-num-display" style="color:#fff;">1/25</span></div>
                </div>
                <div class="question-box">
                    <div id="q-text" class="q-text">Loading...</div>
                </div>
                <div id="options-list" class="options-list"></div>
            </div>

            <div id="result-overlay" class="overlay-popup">
                <div id="res-emoji" class="res-emoji">ðŸŽ‰</div>
                <div id="res-title" class="res-title">UNIT PASSED!</div>
                <div style="font-size:1.8rem; color:var(--primary); margin-bottom:10px; font-weight:900; font-family:'Rajdhani'; text-shadow:0 0 10px rgba(244,196,48,0.5);">
                    SCORE: <span id="final-score">0</span>
                </div>
                <div style="color:#aaa; font-size:1rem;">Correct: <span id="correct-count">0</span> / 25</div>
                <div style="font-size: 0.8rem; color: #ff1744; margin-top: 10px; display:none;" id="fail-msg">Restarting Unit from Question 1</div>
                <button id="res-btn" class="res-btn" onclick="handleResultAction()">NEXT UNIT</button>
            </div>

            <div id="welcome-popup" class="overlay-popup">
                <div class="res-emoji">ðŸ‘‘</div>
                <div class="res-title" style="color:var(--primary);">WELCOME CLUB!</div>
                <div class="welcome-text">
                    Hello <span id="wel-user" class="user-highlight">User</span>, <br>
                    You are now a Premium Member of <span style="color:var(--primary)">STISkilli</span>. <br>
                    Your History journey begins now!
                </div>
                <button class="res-btn" onclick="closeWelcome()">LET'S START</button>
            </div>

            <div id="locked-popup" class="overlay-popup">
                <div class="res-emoji">ðŸ”’</div>
                <div class="res-title" style="color:#ff1744;">CONTENT LOCKED</div>
                <div class="welcome-text">
                    This content is for Premium Members only.<br>
                    Please upgrade your plan to access all Units and Quizzes.
                </div>
                <button class="res-btn" onclick="goToProfileFromLock()">GO TO PROFILE</button>
            </div>

            <div id="profile-section" style="display: none;">
                
                <div id="step-1" class="glass-panel">
                    <div style="width:70px; height:70px; background:rgba(0,0,0,0.5); border-radius:50%; border:2px solid var(--primary); display:flex; align-items:center; justify-content:center; margin-bottom:20px; box-shadow:0 0 20px var(--primary-glow);">
                        <i class="fas fa-crown" style="color:var(--primary); font-size:2rem;"></i>
                    </div>
                    <h2 style="font-family:'Rajdhani'; font-size:2rem; margin-bottom:5px; color:#fff; font-weight:800;">JOIN ELITE CLUB</h2>
                    <p style="color:#888; margin-bottom:25px; font-size:0.9rem;">Unlock the ultimate history experience.</p>
                    
                    <form id="details-form" style="width:100%;">
                        <div class="gold-input-group">
                            <label class="gold-label">FULL NAME</label>
                            <input type="text" id="user-name" class="gold-input" placeholder="e.g. Rahul Kumar" required>
                        </div>
                        <div class="gold-input-group">
                            <label class="gold-label">MOBILE NUMBER</label>
                            <input type="tel" id="user-number" class="gold-input" placeholder="+91 XXXXX XXXXX" required>
                        </div>
                        <div class="gold-input-group">
                            <label class="gold-label">EMAIL ADDRESS</label>
                            <input type="email" id="user-email" class="gold-input" placeholder="name@example.com" required>
                        </div>
                        <button type="submit" class="btn-pro">CONTINUE TO PLANS <i class="fas fa-arrow-right" style="margin-left:10px;"></i></button>
                    </form>
                </div>

                <div id="step-2" class="glass-panel" style="display:none; max-width:600px;">
                    <h2 style="font-family:'Rajdhani'; font-size:2rem; margin-bottom:20px; color:#fff; font-weight:800;">SELECT ACCESS</h2>
                    
                    <div class="plans-grid">
                        <div class="plan-card-pro" onclick="selectPlan(51, '1 Month Access', this)">
                            <div class="pc-check"><i class="fas fa-check-circle"></i></div>
                            <div class="pc-dur">1 Month</div>
                            <div class="pc-price">â‚¹51</div>
                        </div>
                        <div class="plan-card-pro" onclick="selectPlan(101, '3 Months Access', this)">
                            <div class="pc-check"><i class="fas fa-check-circle"></i></div>
                            <div class="pc-dur">3 Months</div>
                            <div class="pc-price">â‚¹101</div>
                        </div>
                        <div class="plan-card-pro" onclick="selectPlan(151, '6 Months Access', this)">
                            <div class="pc-check"><i class="fas fa-check-circle"></i></div>
                            <div class="pc-dur">6 Months</div>
                            <div class="pc-price">â‚¹151</div>
                        </div>
                        <div class="plan-card-pro" onclick="selectPlan(251, '1 Year Access', this)">
                            <div class="pc-check"><i class="fas fa-check-circle"></i></div>
                            <div style="background:var(--primary); color:#000; font-size:0.6rem; padding:2px 6px; border-radius:4px; font-weight:800; margin-bottom:4px;">BEST VALUE</div>
                            <div class="pc-dur">1 Year</div>
                            <div class="pc-price">â‚¹251</div>
                        </div>
                    </div>

                    <div id="secret-code-section" style="display:none; width:100%; margin-bottom:15px;">
                        <input type="text" id="secret-code" class="gold-input" style="text-align:center; margin-bottom:10px;" placeholder="Enter Secret Code">
                        <button id="secret-ok-btn" class="btn-pro" style="display:none;">VERIFY CODE</button>
                    </div>
                    
                    <button id="go-to-pay-btn" class="btn-pro">PROCEED TO PAY</button>
                </div>

                <div id="step-3" class="glass-panel" style="display:none;">
                    <div style="width:60px; height:60px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; margin-bottom:15px;">
                        <i class="fas fa-lock" style="font-size:1.5rem; color:#aaa;"></i>
                    </div>
                    <h2 style="font-family:'Rajdhani'; font-size:1.8rem; margin-bottom:5px; color:#fff;">SECURE PAYMENT</h2>
                    <div style="font-size:0.9rem; color:#888; margin-bottom:20px;">Complete your transaction within</div>
                    
                    <div id="final-price-display" style="font-size:2.5rem; color:var(--primary); font-family:'Rajdhani'; font-weight:800; margin-bottom:10px; text-shadow:0 0 20px rgba(244,196,48,0.3);">â‚¹00.00</div>
                    <div id="timer" style="color:#fff; font-weight:bold; font-size:1.2rem; margin-bottom:30px; background:rgba(30,30,30,0.9); padding:8px 20px; border-radius:50px; border:1px solid #444;">05:00</div>
                    
                    <button id="rzp-button" class="btn-pro">PAY WITH RAZORPAY</button>
                </div>

                <div id="step-4" style="display:none; width:100%; justify-content:center;">
                    <div class="dashboard-container">
                        
                        <div class="membership-card">
                            <div class="mc-header">
                                <div class="mc-chip"></div>
                                <div class="mc-plan-badge" id="disp-plan">PLAN</div>
                            </div>
                            <div class="mc-user">
                                <div class="mc-name" id="disp-name">User Name</div>
                                <div class="mc-email" id="disp-email">email@example.com</div>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-box">
                                <i class="fas fa-trophy sb-icon"></i>
                                <div class="sb-val" id="total-score-display">0</div>
                                <div class="sb-label">Total Score</div>
                            </div>
                            <div class="stat-box">
                                <i class="fas fa-chart-line sb-icon"></i>
                                <div class="sb-val" id="units-played-display">0</div>
                                <div class="sb-label">Units Active</div>
                            </div>
                        </div>

                        <div>
                            <div class="pro-progress-header"><span>PERFORMANCE LOG</span> <i class="fas fa-chevron-down" style="font-size:0.8rem; opacity:0.5;"></i></div>
                            <div id="progress-container" style="padding-bottom:50px;">
                                </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const categoryBackgrounds = {
            profile: 'skilligovtbck.png', ancient: 'anicianthistoryofindia.png', medieval: 'medivalhistoryofindia.png',
            modern: 'modernhistoryofindia.png', world: 'worldhistory.png', art: 'artandcultureofindia.png',
            news: 'skillinewsbck.png' 
        };

        const CHECKPOINT = 25;
        const PASS_REQ = 20;

        // --- 2. CUSTOM DATA ---
        
        const newsDatabase = [
            {
                tag: "DISCOVERY",
                title: "New Harappan Site Found in Gujarat",
                desc: "Archaeologists have unearthed a massive settlement near Dholavira, revealing advanced drainage systems.",
                image: "https://images.unsplash.com/photo-1605634289895-46740b206124?q=80&w=2070&auto=format&fit=crop",
                link: "page_harappa_news.html" 
            },
            {
                tag: "RESEARCH",
                title: "Decoding the Indus Script",
                desc: "AI models suggest new patterns in the undeciphered symbols of the Indus Valley Civilization.",
                image: "https://images.unsplash.com/photo-1628155930542-4d7a78370960?q=80&w=2070&auto=format&fit=crop",
                link: "page_ai_script.html" 
            },
            {
                tag: "EVENT",
                title: "World History Conference 2026",
                desc: "Join the biggest virtual gathering of historians this March. Exclusive access for Premium members.",
                image: "https://images.unsplash.com/photo-1544928147-79a2dbc1f389?q=80&w=1974&auto=format&fit=crop",
                link: "page_conference.html" 
            },
            {
                tag: "MYSTERY",
                title: "The Lost Library of Nalanda",
                desc: "A deep dive into what was lost and what remains of the ancient university's vast knowledge.",
                image: "https://images.unsplash.com/photo-1590076215667-875d4ef2d743?q=80&w=2070&auto=format&fit=crop",
                link: "page_nalanda.html" 
            }
        ];

        const quizDatabase = {
            ancient: [
                { name: "1857 REVOLUTION OF INDIA", questions: [ { q: "Oldest Veda?", options: ["Rigveda", "Samaveda", "Yajur", "Atharva"], ans: 0 }, { q: "Great Bath found in?", options: ["Harappa", "Mohenjodaro", "Lothal", "Kalibangan"], ans: 1 } ] },
                { name: "Mauryan Empire", questions: [ { q: "Arthashastra author?", options: ["Chanakya", "Megasthenes", "Kalidasa", "Ashoka"], ans: 0 }, { q: "Kalinga War Year?", options: ["261 BC", "273 BC", "232 BC", "240 BC"], ans: 0 } ] },
                { name: "Gupta Era", questions: [ { q: "Napoleon of India?", options: ["Samudragupta", "Chandragupta", "Ashoka", "Harsha"], ans: 0 }, { q: "Kalidasa court?", options: ["Chandragupta II", "Akbar", "Ashoka", "Kanishka"], ans: 0 } ] },
                { name: "South Dynasties", questions: [ { q: "Chola Capital?", options: ["Thanjavur", "Madurai", "Kanchi", "Vatapi"], ans: 0 }, { q: "Ellora builder?", options: ["Rashtrakuta", "Chola", "Pallava", "Gupta"], ans: 0 } ] }
            ],
            medieval: [
                { name: "Delhi Sultanate", questions: [ { q: "Slave Dynasty founder?", options: ["Aibak", "Iltutmish", "Balban", "Razia"], ans: 0 }, { q: "Market Control?", options: ["Alauddin", "Balban", "Firoz", "Akbar"], ans: 0 } ] },
                { name: "Mughals", questions: [ { q: "Ain-i-Akbari author?", options: ["Abul Fazl", "Birbal", "Faizi", "Todar"], ans: 0 }, { q: "Haldighati Year?", options: ["1576", "1526", "1556", "1761"], ans: 0 } ] },
                { name: "Marathas", questions: [ { q: "Shivaji Crowned?", options: ["1674", "1665", "1680", "1650"], ans: 0 }, { q: "Purandar Treaty?", options: ["Jai Singh", "Afzal", "Shaista", "Aurangzeb"], ans: 0 } ] },
                { name: "Bhakti Movement", questions: [ { q: "Kabir Guru?", options: ["Ramananda", "Ramanuja", "Shankara", "Nanak"], ans: 0 }, { q: "Chisti Dargah?", options: ["Ajmer", "Delhi", "Agra", "Lahore"], ans: 0 } ] }
            ],
            modern: [
                { name: "Revolt 1857", questions: [ { q: "1857 Start?", options: ["Meerut", "Delhi", "Kanpur", "Jhansi"], ans: 0 }, { q: "Last Mughal?", options: ["Bahadur Shah II", "Aurangzeb", "Shah Alam", "Akbar II"], ans: 0 } ] },
                { name: "Gandhi Era", questions: [ { q: "Gandhi Return?", options: ["1915", "1917", "1919", "1920"], ans: 0 }, { q: "First Satyagraha?", options: ["Champaran", "Kheda", "Dandi", "Bardoli"], ans: 0 } ] },
                { name: "Freedom Struggle", questions: [ { q: "INC Founded?", options: ["1885", "1905", "1920", "1947"], ans: 0 }, { q: "Do or Die?", options: ["Gandhi", "Nehru", "Bose", "Tilak"], ans: 0 } ] },
                { name: "Independence", questions: [ { q: "Mountbatten Plan?", options: ["3 June 1947", "15 Aug", "26 Jan", "1946"], ans: 0 }, { q: "Iron Man?", options: ["Patel", "Nehru", "Gandhi", "Bose"], ans: 0 } ] }
            ],
            world: [
                { name: "World Wars", questions: [ { q: "WW1 Start?", options: ["1914", "1918", "1939", "1945"], ans: 0 }, { q: "Versailles Treaty?", options: ["WW1", "WW2", "Cold War", "French"], ans: 0 } ] },
                { name: "Revolutions", questions: [ { q: "French Rev?", options: ["1789", "1799", "1776", "1804"], ans: 0 }, { q: "Russian Rev?", options: ["1917", "1914", "1920", "1905"], ans: 0 } ] },
                { name: "Cold War", questions: [ { q: "Cold War?", options: ["USA vs USSR", "USA vs China", "UK vs Ger", "Ind vs Pak"], ans: 0 }, { q: "Berlin Wall Fall?", options: ["1989", "1991", "1945", "1960"], ans: 0 } ] },
                { name: "Modern Era", questions: [ { q: "UN Founded?", options: ["1945", "1919", "1950", "1947"], ans: 0 }, { q: "Industrial Rev?", options: ["England", "France", "USA", "Germany"], ans: 0 } ] }
            ],
            art: [
                { name: "Dance Forms", questions: [ { q: "Bharatnatyam?", options: ["TN", "Kerala", "AP", "Odisha"], ans: 0 }, { q: "Kathakali?", options: ["Kerala", "Karnataka", "UP", "Assam"], ans: 0 } ] },
                { name: "Music", questions: [ { q: "Hindustani Oldest?", options: ["Dhrupad", "Khayal", "Thumri", "Ghazal"], ans: 0 }, { q: "Sama Veda?", options: ["Music", "Magic", "Medicine", "Rituals"], ans: 0 } ] },
                { name: "Architecture", questions: [ { q: "Sun Temple?", options: ["Konark", "Puri", "Bhubaneswar", "Cuttack"], ans: 0 }, { q: "Taj Mahal?", options: ["Shah Jahan", "Akbar", "Jahangir", "Aurangzeb"], ans: 0 } ] },
                { name: "Paintings", questions: [ { q: "Madhubani?", options: ["Bihar", "Bengal", "Odisha", "Gujarat"], ans: 0 }, { q: "Ajanta?", options: ["Jatakas", "Ramayana", "Mahabharata", "Vedas"], ans: 0 } ] }
            ]
        };

        // --- 3. STATE MANAGEMENT ---
        let userData = {
            name: localStorage.getItem('userName') || '',
            number: localStorage.getItem('userMobile') || '',
            email: localStorage.getItem('userEmail') || '',
            txn: localStorage.getItem('userTxn') || '',
            planAmount: localStorage.getItem('userPlanAmount') || '',
            planName: localStorage.getItem('userPlanName') || ''
        };
        
        let selectedPlanPrice = 0, selectedPlanLabel = "";
        
        let progressData;
        try {
            progressData = JSON.parse(localStorage.getItem('quizProgress')) || {};
        } catch(e) {
            progressData = {};
        }

        let unlockedLevels;
        try {
            unlockedLevels = JSON.parse(localStorage.getItem('unlockedLevels')) || { ancient: 1, medieval: 1, modern: 1, world: 1, art: 1 };
        } catch (e) {
            unlockedLevels = { ancient: 1, medieval: 1, modern: 1, world: 1, art: 1 };
        }

        let activeCat = "", activeUnitIdx = 0;
        let currentSession = { score: 0, correct: 0, wrong: 0, qIndex: 0 };
        let blockCorrect = 0; 
        let questionTimer;
        let timeLeft = 30;

        function hasPaid() { return localStorage.getItem('hasPaid') === 'true'; }

        // --- 4. NAVIGATION ---
        function openCategory(catName, btnElement) {
            if(questionTimer) clearInterval(questionTimer);

            if (catName !== 'profile' && !hasPaid()) {
                document.getElementById('locked-popup').style.display = 'flex';
                return;
            }

            if (btnElement) {
                document.querySelectorAll('.dock-item').forEach(el => el.classList.remove('active'));
                btnElement.classList.add('active');
            }

            const modalBox = document.getElementById('dynamic-modal-box');
            modalBox.style.backgroundImage = `url('${categoryBackgrounds[catName] || 'skilligovtbck.png'}')`;
            
            let dispTitle = catName.toUpperCase();
            if(catName === 'news') dispTitle = "DISCOVERIES";
            else if(catName !== 'profile') dispTitle += " HISTORY";
            document.getElementById('cat-title').innerText = dispTitle;

            const quizUI = document.getElementById('quiz-interface');
            const profileUI = document.getElementById('profile-section');
            const newsUI = document.getElementById('news-section');
            const subNav = document.getElementById('sub-nav-container');

            quizUI.style.display = 'none';
            profileUI.style.display = 'none';
            newsUI.style.display = 'none';
            subNav.style.display = 'none';
            document.getElementById('result-overlay').style.display = 'none';
            document.getElementById('locked-popup').style.display = 'none';

            if (catName === 'profile') {
                profileUI.style.display = 'flex';
                initProfileView();
            } else if (catName === 'news') {
                newsUI.style.display = 'flex';
                renderNews();
            } else {
                quizUI.style.display = 'flex';
                subNav.style.display = 'flex';
                activeCat = catName;
                renderSubNav(catName);
                switchUnit(0, document.getElementById(`sub-unit-0`)); 
            }
        }

        function renderNews() {
            const feed = document.getElementById('news-feed');
            feed.innerHTML = '';
            
            newsDatabase.forEach(item => {
                const card = document.createElement('div');
                card.className = 'news-card';
                card.innerHTML = `
                    <img src="${item.image}" class="news-img" alt="News">
                    <div class="news-body">
                        <div class="news-tag">${item.tag}</div>
                        <div class="news-title">${item.title}</div>
                        <div class="news-desc">${item.desc}</div>
                        <a href="${item.link}" class="news-btn">READ FULL STORY <i class="fas fa-arrow-right"></i></a>
                    </div>
                `;
                feed.appendChild(card);
            });
        }

        function renderSubNav(catName) {
            const container = document.getElementById('sub-nav-container');
            const units = quizDatabase[catName];
            
            if(!units) {
                container.innerHTML = '<div style="color:#aaa; padding:10px;">Coming Soon</div>';
                document.getElementById('q-text').innerText = "No content available for this category.";
                document.getElementById('options-list').innerHTML = '';
                return;
            }

            if (!unlockedLevels[catName]) unlockedLevels[catName] = 1;
            const maxLvl = unlockedLevels[catName];
            
            container.innerHTML = units.map((u, i) => {
                const isLocked = (i + 1) > maxLvl;
                return `<div class="sub-item ${isLocked?'locked':''}" id="sub-unit-${i}" ${isLocked?'':`onclick="switchUnit(${i}, this)"`}>${u.name} ${isLocked?'<i class="fas fa-lock"></i>':''}</div>`;
            }).join('');
        }

        function switchUnit(idx, el) {
            idx = parseInt(idx);
            
            if(!el && document.getElementById(`sub-unit-${idx}`)) el = document.getElementById(`sub-unit-${idx}`);
            if(el) {
                document.querySelectorAll('.sub-item').forEach(e => e.classList.remove('active'));
                el.classList.add('active');
            }
            startQuiz(idx);
        }

        // --- 5. QUIZ ENGINE (WITH RANDOMIZATION) ---
        function startQuiz(idx) {
            if(questionTimer) clearInterval(questionTimer);
            activeUnitIdx = idx;
            document.getElementById('result-overlay').style.display = 'none';
            
            if(!quizDatabase[activeCat] || !quizDatabase[activeCat][idx]) {
                document.getElementById('q-text').innerText = "Unit not found.";
                return;
            }

            const unitName = quizDatabase[activeCat][idx].name;
            document.getElementById('unit-name-display').innerText = unitName;

            if (!progressData[activeCat]) progressData[activeCat] = {};
            if (!progressData[activeCat][idx]) {
                progressData[activeCat][idx] = { score: 0, correct: 0, wrong: 0, qIndex: 0, blockCorrect: 0, order: [] };
            }
            
            currentSession = progressData[activeCat][idx];
            blockCorrect = currentSession.blockCorrect || 0; 

            const totalQuestions = quizDatabase[activeCat][idx].questions.length;
            if(!currentSession.order || currentSession.order.length !== totalQuestions) {
                currentSession.order = Array.from({length: totalQuestions}, (_, i) => i);
                for (let i = currentSession.order.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [currentSession.order[i], currentSession.order[j]] = [currentSession.order[j], currentSession.order[i]];
                }
                saveProgress();
            }
            
            loadQuestion();
        }

        function loadQuestion() {
            if(questionTimer) clearInterval(questionTimer);
            
            try {
                if(!quizDatabase[activeCat] || !quizDatabase[activeCat][activeUnitIdx]) return;
                
                const db = quizDatabase[activeCat][activeUnitIdx].questions;
                if(!db || db.length === 0) {
                    document.getElementById('q-text').innerText = "No questions in this unit.";
                    return;
                }

                const shuffledIndex = currentSession.order[currentSession.qIndex % db.length];
                const actualQ = db[shuffledIndex];
                
                const displayNum = currentSession.qIndex + 1;
                const currentBatchLimit = CHECKPOINT * (Math.floor(currentSession.qIndex/CHECKPOINT) + 1);
                
                document.getElementById('q-num-display').innerText = `${displayNum} / ${currentBatchLimit}`;
                document.getElementById('q-text').innerText = actualQ.q;

                const list = document.getElementById('options-list');
                list.innerHTML = '';
                actualQ.options.forEach((opt, i) => {
                    const btn = document.createElement('div');
                    btn.className = 'option-btn';
                    btn.innerHTML = `<span>${opt}</span> <i class="far fa-circle"></i>`;
                    btn.onclick = () => handleAnswer(i, actualQ.ans, btn);
                    list.appendChild(btn);
                });

                startTimerLogic(actualQ.ans);

            } catch (error) {
                console.error("Error loading question:", error);
                document.getElementById('q-text').innerText = "Error loading question. Resetting unit...";
                currentSession = { score: 0, correct: 0, wrong: 0, qIndex: 0, blockCorrect: 0, order: [] };
                saveProgress();
                setTimeout(() => startQuiz(activeUnitIdx), 1500);
            }
        }

        function startTimerLogic(correctIndex) {
            timeLeft = 30;
            document.getElementById('q-timer').innerText = timeLeft;
            
            questionTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('q-timer').innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(questionTimer);
                    handleTimeOut(correctIndex);
                }
            }, 1000);
        }

        function handleTimeOut(correctIndex) {
            document.querySelectorAll('.option-btn').forEach(b => b.onclick = null);
            const btns = document.querySelectorAll('.option-btn');
            if(btns[correctIndex]) btns[correctIndex].classList.add('correct');
            
            currentSession.score -= 0.25;
            currentSession.wrong++;
            currentSession.qIndex++;
            currentSession.blockCorrect = blockCorrect;
            saveProgress();
            
            setTimeout(() => {
                checkResultOrNext();
            }, 1500);
        }

        function handleAnswer(sel, cor, btn) {
            clearInterval(questionTimer);
            document.querySelectorAll('.option-btn').forEach(b => b.onclick = null);

            if(sel === cor) {
                btn.classList.add('correct');
                currentSession.score += 2;
                currentSession.correct++;
                blockCorrect++;
            } else {
                btn.classList.add('wrong');
                currentSession.score -= 0.25;
                currentSession.wrong++;
                const allBtns = document.querySelectorAll('.option-btn');
                if(allBtns[cor]) allBtns[cor].classList.add('correct');
            }

            currentSession.qIndex++;
            currentSession.blockCorrect = blockCorrect;
            saveProgress();

            setTimeout(() => {
                checkResultOrNext();
            }, 1000);
        }

        function checkResultOrNext() {
            if (currentSession.qIndex > 0 && currentSession.qIndex % CHECKPOINT === 0) {
                showResultPopup();
            } else {
                loadQuestion();
            }
        }

        function saveProgress() {
            if (!progressData[activeCat]) progressData[activeCat] = {};
            progressData[activeCat][activeUnitIdx] = currentSession;
            localStorage.setItem('quizProgress', JSON.stringify(progressData));
        }

        function showResultPopup() {
            const overlay = document.getElementById('result-overlay');
            const emoji = document.getElementById('res-emoji');
            const title = document.getElementById('res-title');
            const btn = document.getElementById('res-btn');
            const failMsg = document.getElementById('fail-msg');

            document.getElementById('final-score').innerText = currentSession.score.toFixed(2);
            document.getElementById('correct-count').innerText = `${blockCorrect} / ${CHECKPOINT}`;

            if (blockCorrect >= PASS_REQ) {
                emoji.innerText = "ðŸŽ‰";
                title.innerText = "UNIT PASSED!";
                title.style.color = "#00e676";
                failMsg.style.display = "none";
                btn.innerText = "NEXT 25 Q";
                
                const totalUnits = quizDatabase[activeCat].length;
                if(activeUnitIdx + 1 === unlockedLevels[activeCat] && unlockedLevels[activeCat] < totalUnits) {
                    unlockedLevels[activeCat]++;
                    localStorage.setItem('unlockedLevels', JSON.stringify(unlockedLevels));
                    renderSubNav(activeCat);
                }

                btn.onclick = () => {
                    blockCorrect = 0; 
                    currentSession.blockCorrect = 0; 
                    saveProgress();
                    overlay.style.display = 'none'; 
                    loadQuestion();
                };
            } else {
                emoji.innerText = "ðŸ˜¢";
                title.innerText = "FAILED!";
                title.style.color = "#ff1744";
                failMsg.style.display = "block";
                btn.innerText = "RESTART UNIT";
                btn.onclick = () => {
                    currentSession.qIndex = 0; 
                    currentSession.score = 0; 
                    currentSession.correct = 0; 
                    currentSession.wrong = 0; 
                    currentSession.order = []; 
                    blockCorrect = 0;
                    saveProgress(); 
                    overlay.style.display = 'none'; 
                    startQuiz(activeUnitIdx); 
                };
            }
            overlay.style.display = 'flex';
        }

        // --- 6. PROFILE & LOGIC ---
        function initProfileView() {
            if (hasPaid()) {
                showStep(4);
                document.getElementById('disp-name').innerText = userData.name;
                document.getElementById('disp-email').innerText = userData.email;
                document.getElementById('disp-plan').innerText = userData.planName;
                renderProgressReport();
            } else { showStep(1); }
        }

        function renderProgressReport() {
            const container = document.getElementById('progress-container');
            container.innerHTML = '';
            let hasData = false;
            let grandTotal = 0;
            let unitsPlayed = 0;

            for (const cat in progressData) {
                if(!quizDatabase[cat]) continue;

                for (const uIdx in progressData[cat]) {
                    const d = progressData[cat][uIdx];
                    if(d.qIndex > 0) {
                        hasData = true;
                        unitsPlayed++;
                        grandTotal += d.score;

                        const total = d.correct + d.wrong;
                        const correctPct = total === 0 ? 0 : (d.correct / total) * 100;
                        const unitObj = quizDatabase[cat][uIdx];
                        const uName = unitObj ? unitObj.name : `Unit ${parseInt(uIdx)+1}`;
                        
                        container.innerHTML += `
                        <div class="pp-item">
                            <div class="pp-top">
                                <span class="pp-title">${cat.toUpperCase()} / ${uName}</span>
                                <span class="pp-score">${d.score.toFixed(1)} PTS</span>
                            </div>
                            <div class="pp-bar-bg">
                                <div class="pp-bar-fill" style="width:${correctPct}%"></div>
                            </div>
                            <div class="pp-meta">
                                <span><i class="fas fa-check" style="color:var(--correct)"></i> ${d.correct}</span>
                                <span><i class="fas fa-times" style="color:var(--wrong)"></i> ${d.wrong}</span>
                            </div>
                        </div>`;
                    }
                }
            }
            if(!hasData) container.innerHTML = '<div style="color:#555; text-align:center; padding-top:20px;">No history data found. Start a quiz!</div>';
            
            try {
                document.getElementById('total-score-display').innerText = grandTotal.toFixed(0);
                document.getElementById('units-played-display').innerText = unitsPlayed;
            } catch(e) {}
        }

        function goToProfileFromLock() {
            document.getElementById('locked-popup').style.display = 'none';
            openCategory('profile', document.getElementById('nav-profile'));
        }

        function showStep(n) { [1,2,3,4].forEach(i=>document.getElementById(`step-${i}`).style.display='none'); document.getElementById(`step-${n}`).style.display = (n===4?'flex':'flex'); }

        document.getElementById('details-form').addEventListener('submit', (e) => {
            e.preventDefault();
            userData.name = document.getElementById('user-name').value;
            userData.number = document.getElementById('user-number').value;
            userData.email = document.getElementById('user-email').value;
            const last = userData.name.toLowerCase().split(' ').pop();
            if(['insa','insha','insan'].includes(last)) { 
                document.getElementById('secret-code-section').style.display='block'; 
                document.getElementById('go-to-pay-btn').style.display='none'; 
            }
            showStep(2);
        });

        function selectPlan(p, l, el) { selectedPlanPrice=p; selectedPlanLabel=l; document.querySelectorAll('.plan-card-pro').forEach(c=>c.classList.remove('selected')); el.classList.add('selected'); }
        
        document.getElementById('secret-code').addEventListener('input', (e)=>{ if(e.target.value==='MSGMSGMSG') document.getElementById('secret-ok-btn').style.display='block'; });
        document.getElementById('secret-ok-btn').addEventListener('click', ()=>{ userData.planName='Lifetime VIP'; userData.txn='MSG-FREE'; userData.planAmount='0'; sendToSheet(); completeTxn(); });

        document.getElementById('go-to-pay-btn').addEventListener('click', () => {
            if(!selectedPlanPrice) return alert("Please select a plan.");
            document.getElementById('final-price-display').innerText = `â‚¹${selectedPlanPrice}.00`;
            showStep(3); startTimer();
        });

        let tInt;
        function startTimer() { 
            let t=300; 
            if(tInt) clearInterval(tInt); 
            tInt=setInterval(()=>{ 
                let m=Math.floor(t/60),s=t%60; 
                document.getElementById('timer').innerText=`${m}:${s<10?'0'+s:s}`; 
                t--; 
                if(t<0) { clearInterval(tInt); alert("Expired"); showStep(1); } 
            },1000); 
        }

        document.getElementById('rzp-button').addEventListener('click', () => {
            const rzp = new Razorpay({
                key: "rzp_live_zyUA84YdEZR7rO", amount: selectedPlanPrice*100, currency: "INR",
                name: "SKILLI PRO", description: selectedPlanLabel,
                handler: function(r){ 
                    userData.txn=r.razorpay_payment_id; 
                    userData.planAmount=selectedPlanPrice; 
                    userData.planName=selectedPlanLabel; 
                    sendToSheet();
                    completeTxn(); 
                },
                prefill: { name: userData.name, email: userData.email, contact: userData.number }, theme: { color: "#F4C430" }
            });
            rzp.open();
        });

        async function sendToSheet() {
            const url = 'https://script.google.com/macros/s/AKfycbxOET0tOiJTHgYVDlBWyz6-rAHMQqd32_ezqmQa13HSQv-DVo3ZvQtNppPZgHcISApXhw/exec';
            const fd = new FormData();
            fd.append('name', userData.name);
            fd.append('number', userData.number);
            fd.append('email', userData.email);
            fd.append('amount', userData.planAmount);
            fd.append('plan_name', userData.planName);
            fd.append('transaction_id', userData.txn);
            try { await fetch(url, { method:'POST', body:fd }); } catch(e){ console.log(e); }
        }

        function completeTxn() {
            if(tInt) clearInterval(tInt);
            localStorage.setItem('hasPaid','true'); 
            localStorage.setItem('userName',userData.name);
            localStorage.setItem('userEmail',userData.email);
            localStorage.setItem('userTxn',userData.txn); 
            localStorage.setItem('userPlanName',userData.planName);
            document.getElementById('wel-user').innerText = userData.name;
            document.getElementById('welcome-popup').style.display = 'flex';
        }

        function closeWelcome() {
            document.getElementById('welcome-popup').style.display = 'none';
            initProfileView();
        }

        window.addEventListener('DOMContentLoaded', () => {
            if(hasPaid()) openCategory('ancient', document.getElementById('nav-ancient'));
            else openCategory('profile', document.getElementById('nav-profile'));
        });
    </script>
</body>
</html>
